i<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chat</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
</head>
<style>
#llm_list {
    display: none; /* Hide the model list since we're not using it */
}
</style>
<body>

<div class="container">
      <h1>Chat</h1>

      <h2>Demo</h2>

      <p>
        This web demo enables you to run LLM models from Hugging Face (GGUF/GGML/tiny-llama2/starcoder/etc) directly in your browser.
      </p>

      <form onsubmit="event.preventDefault();">
        <div>
            <progress id="progress" hidden></progress>
        </div>

        <label for="textInput">Craft your <i>prompt</i>ðŸ“„:</label>
        <textarea id="textInput" name="textInput" rows="10"></textarea>
                
        <button id="submitBtn" disabled>Run</button>
      </form>

      <div id="result">
        <h3>Result</h3>
        <pre><code id="output" style="white-space: pre-wrap;"></code></pre>
      </div>
    </div>

    <script type="module">
        import {LLM} from "./llm.js/llm.js";

        let LLMEngine;

        let progress = document.getElementById('progress');
        let submitButton = document.getElementById('submitBtn');

        let inputElement = document.getElementById('textInput');
        let outputElement = document.getElementById('output');

        const tinyLlamaModel = {
            "name": "TinyLLama 1.5T (482 MB)",
            "link": "https://huggingface.co/Corianas/tiny-llama-miniguanaco-1.5T",
            "model": "https://huggingface.co/rahuldshetty/llm.js/resolve/main/tiny-llama-miniguanaco-1.5t.q2_k.gguf",
            "prompt": "{prompt}\n",
            "type": "LLAMA"
        };

        // Event Listener Functions
        const on_loaded = () => {
            submitButton.disabled = false;
            progress.hidden = true;
        }

        const write_result = (line) => {
            outputElement.textContent += line + "\n";
            if (line.includes("<END>")) {
                LLMEngine.stop();
                submitButton.disabled = false;
            }
        }

        const run_complete = () => {
            submitButton.disabled = false;
        }

        const load_llm_from_url = (link, type) => {
            progress.hidden = false;
            submitButton.disabled = true;

            LLMEngine = new LLM(
                type,
                link,
                on_loaded,
                write_result,
                run_complete
            );

            LLMEngine.load_worker();
        }

        const run_model = (e) => {
            const text = document.getElementById("textInput").value;
            submitButton.disabled = true;
            outputElement.textContent = ""; // clear old content
            LLMEngine.run({
                prompt: text,
                max_token_len: 100,
                top_k: 1,
            });
        }

        // Load the TinyLLama model automatically on page load
        document.addEventListener("DOMContentLoaded", () => {
            inputElement.textContent = tinyLlamaModel.prompt;
            load_llm_from_url(tinyLlamaModel.model, tinyLlamaModel.type);
        });

        submitButton.addEventListener("click", run_model);

    </script>

    </body>
</html>

